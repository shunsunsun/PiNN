

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Miscellaneous Notes &#8212; PiNN  documentation</title>
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Reference" href="reference.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="reference.html" title="Reference"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PiNN  documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="datasets.html">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks.html">Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="ase.html">ASE interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Miscellaneous Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#known-issue-with-ase-barostats">Known issue with ASE barostats</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="miscellaneous-notes">
<h1>Miscellaneous Notes<a class="headerlink" href="#miscellaneous-notes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="known-issue-with-ase-barostats">
<h2>Known issue with ASE barostats<a class="headerlink" href="#known-issue-with-ase-barostats" title="Permalink to this headline">¶</a></h2>
<p>As in ASE version 3.18, the ASE implementation of Berendsen barostat
misses the ideal gas contribution (see this <a class="reference external" href="https://gitlab.com/ase/ase/issues/356">issue</a>). This causes
systematic errors when using PiNN (or any other potential) with ASE
for NPT simulations. The barostat can be patched as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.md.nptberendsen</span> <span class="kn">import</span> <span class="n">NPTBerendsen</span>
<span class="kn">from</span> <span class="nn">ase</span> <span class="kn">import</span> <span class="n">units</span>

<span class="k">def</span> <span class="nf">scale_positions_and_cell_with_p_kin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Do the Berendsen pressure coupling,</span>
<span class="sd">    scale the atom position and the simulation cell.&quot;&quot;&quot;</span>
    <span class="n">taupscl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">taup</span>
    <span class="n">stress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_stress</span><span class="p">(</span><span class="n">voigt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">old_pressure</span> <span class="o">=</span> <span class="o">-</span><span class="n">stress</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="mf">1e-5</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">Pascal</span>
    <span class="n">p_kin</span> <span class="o">=</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_volume</span><span class="p">()</span><span class="o">*</span><span class="mf">1e30</span><span class="p">)</span><span class="o">*</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span><span class="o">*</span><span class="mf">1.38e-23</span><span class="o">*</span><span class="mf">1e-5</span><span class="p">)</span>
    <span class="n">old_pressure</span> <span class="o">+=</span> <span class="n">p_kin</span>
    <span class="n">scl_pressure</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">taupscl</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">compressibility</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">-</span> <span class="n">old_pressure</span><span class="p">))</span>

    <span class="c1"># Alternatively, the scaling factor can be calculated using</span>
    <span class="c1"># the below equivalent fomular, which is used in LAMMPS.</span>
    <span class="c1"># Both are benchmarked for comparison, the above formular is</span>
    <span class="c1"># noted as patch 1 and the version below as patch 2.</span>
    <span class="c1">#</span>
    <span class="c1"># scl_pressure = (1.0 - taupscl * self.compressibility *</span>
    <span class="c1">#                (self.pressure - old_pressure)) ** (1./3.)</span>

    <span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">scl_pressure</span> <span class="o">*</span> <span class="n">cell</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">scale_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">NPTBerendsen</span><span class="o">.</span><span class="n">scale_positions_and_cell</span> <span class="o">=</span> <span class="n">scale_positions_and_cell_with_p_kin</span>
</pre></div>
</div>
<p>The patch is benchmarked against LAMMPS at a known density of
Lennard-Jones fluids. As shown below, the patched barostat agrees well
with the LAMMPS implementation, while the original ASE barostat
overestimates the equilibrium density. Similar issues may exist in
other ASE barostats.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="_images/barostat_benchmark.png"><img alt="_images/barostat_benchmark.png" src="_images/barostat_benchmark.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Fig. Equilibrium densities of liquid argon at 78 K and 0.2933 bar
using different implementations of the Berendsen barostat. Dashed
line is from the NIST website.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="detailed-parameters-for-the-benchmark">
<h3>Detailed parameters for the benchmark<a class="headerlink" href="#detailed-parameters-for-the-benchmark" title="Permalink to this headline">¶</a></h3>
<p>The Lennard-Jones parameters proposed by Rahman <a class="bibtex reference internal" href="reference.html#rahman1964" id="id1">[3]</a> for
Argon is used. The simulations were carried out at 78 K and 0.2933
bar. For each barostat, a cubic simulation box was build as a 10x10x10
simple cubic lattice of argon atoms, with a box size of 35 Å. Cutoff
was set to 17 Å and no tail correction was applied. Random velocity
was assigned to each atom to achieve an initial temperature of
78 K. Each system was equilibrated using a Berendsen thermostat for
100 ps with fixed simulation box. The Berendsen barostat was then
turned on to carry out NPT simulation for 200 ps. The timestep was
chosen to be 10 fs, the thermostat and barostat time constants were
chosen to be 10 ps and 100 ps respectively, while the compressibility
was chosen to be 0.01 bar <sup>-1</sup>. For the sake of cross-check, the
corresponding density given at the <a class="reference external" href="https://www.nist.gov/mml/csd/chemical-informatics-research-group/sat-tmmc-liquid-vapor-coexistence-properties-cut">NIST standard reference simulation
website</a> is also shown, which is 1.454 g/mL after conversion from
reduced unit.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="reference.html" title="Reference"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PiNN  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Yunqi Shao.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1.
    </div>
  </body>
</html>